Declare @CurrentFolderID Int = 0 Declare @CurrentFolderVersionID int = 0  Declare @CurrentFormInstanceID int = 0  Declare @NewFormID int = 0  Declare @NewFormDesignVersionID int = 0  Declare @NewFormDesignGroupID int = 0  Declare @FolderVersionCount int = 0  Declare @ForminstanceCount int = 0  Declare @ForminstanceDatamapCount int = 0  Declare @AccountFolderMapCount int = 0  Declare @AccountProductMapCount int = 0  Declare @FolderVersionWorkFlowStateCount int = 0  Declare @WorkFlowStateFolderVersionMapCount int = 0  Declare @WorkFlowStateUserMapCount int = 0  Declare @Formdata nvarchar(max)  Declare @NewUserID Int  Declare @NewCategoryID Int = NULL  Declare @NewConsortiumID Int = NULL  Declare @NewAnchorDocumentID Int = NULL  Declare @Sql Nvarchar(4000) Select @NewUserID = UserID From [Sec].[User] where UserName = 'Superuser' If Object_ID('Tempdb..#FormInstancedataMap')IS Not Null Begin Drop Table #FormInstancedataMap End  Create Table #FormInstancedataMap(FormData Nvarchar(max)) Begin Try  Begin Transaction Set @NewFormDesignGroupID = NULL Insert Into Fldr.Folder(IsPortfolio,Name, MarketSegmentID,PrimaryContent,PrimaryContentID,TenantID,AddedDate,AddedBy,ParentFolderId, FormDesignGroupId,IsFoundation,MasterListFormDesignID,StateName,LineofBusiness,FundingArrangement,Region,IsPackage,FolderType,QuoteID,IsCancel,MoveQuotetoAccount)Values(0,'ADFMasterDemo','','',@NewUserID,1,'2022/07/25', 'Superuser',NULL,@NewFormDesignGroupID,0,0,'','','Not Applicable','','0','0','',NULL,0) Select @CurrentFolderID = IDENT_CURRENT('Fldr.Folder') Select  @NewCategoryID =NULL Select  @NewConsortiumID =NULL Insert Into Fldr.FolderVersion (FolderID,EffectiveDate,WFStateID,FolderVersionNumber,VersionTypeID,IsActive,TenantID,AddedDate,AddedBy,Comments,FolderVersionStateID,ConsortiumID,CategoryID) Values(@CurrentFolderID , '2022/07/19' , NULL  , '2022_0.01'     , 1 , 1  , 1  , '2022/07/25'  , 'Superuser'        , 'superUser created Initial minor version 2022_0.01'    , 1,@NewConsortiumID, @NewCategoryID) Select @CurrentFolderVersionID = IDENT_CURRENT('Fldr.FolderVersion') Select @NewFormID = [dbo].[GetFormID]('ADFMasterDemo')  Select @NewFormDesignVersionID = [dbo].[GetFormDesignVersionID](@NewFormID,'2022/07/19') IF (@NewFormDesignVersionID = NULL or @NewFormDesignVersionID = '')Begin RAISERROR('Formdesign Version is not presented for given formdesign and Effectivedate  ', 16, 1);End Insert Into Fldr.FormInstance (TenantID,AddedDate ,AddedBy,FolderVersionID,FormDesignID,FormDesignVersionID,Name,IsActive,ProductJsonHash,DOCID,AnchorDocumentID,FormInstanceMapTypeId) Values( 1  ,'2022/07/25'  ,'Superuser'   ,@CurrentFolderVersionID  ,@NewFormID  ,@NewFormDesignVersionID  ,'ADFMasterDemo' ,1 ,NULL,'2445754' ,0 ,0 ) Select @CurrentFormInstanceID = IDENT_CURRENT('Fldr.FormInstance') Exec [dbo].[UpdateFormInstanceDocID] @CurrentFormInstanceID,'ADFMasterDemo' Select @NewAnchorDocumentID = ForminstanceID from fldr.forminstance f Inner Join  UI.FormDesign fv on f.FormDesignID = fv.FormID  where [Name] = 'ADFMasterDemo' and FolderVersionID=@CurrentFolderVersionID and  fv.FormName='CommercialMedicalAnchor' Update Fldr.Forminstance set AnchordocumentID =Isnull(@NewAnchorDocumentID,0) where FolderVersionID=@CurrentFolderVersionID and ForminstanceID =@CurrentFormInstanceID Insert Into Fldr.FormInstanceDataMap(FormInstanceID,ObjectInstanceID,CompressJsonData) Values( @CurrentForminstanceID,0,NULL) Update fi Set FormData = dbo.Unzip('KQAAAB+LCAAAAAAABACrVnLNLXBJLUnMzClWslKoBnE9XZSslJR0QEy/xNxUEKe2FgCUqjf4KQAAAA==') From Fldr.FormInstanceDataMap fi Where  fi.ForminstanceID = @CurrentForminstanceID  select @FolderVersionCount = COunt(1) from Fldr.FolderVersion where FolderID=@CurrentFolderID  Select @ForminstanceCount = COunt(1)  from Fldr.FormInstance where FolderVersionID In(Select Distinct FolderVersionID from Fldr.FolderVersion where FolderID = @CurrentFolderID)  Select @ForminstanceDatamapCount= count(1)  from Fldr.FormInstanceDataMap where FormInstanceID In(Select Distinct FormInstanceID from Fldr.FormInstance f inner Join Fldr.FolderVersion fv On F.FolderVersionID = fv.FolderVersionID  where FolderID = @CurrentFolderID)  select @AccountFolderMapCount= COunt(1) from Accn.AccountFolderMap where FolderID = @CurrentFolderID  select @AccountProductMapCount= Count(1) from Accn.AccountProductMap where FolderID = @CurrentFolderID  Select @FolderVersionWorkFlowStateCount= Count(1)  from fldr.FolderVersionWorkFlowState f Inner Join Fldr.FolderVersion fv on f.FolderVersionID = fv.FolderVersionID where FolderID = @CurrentFolderID  select @WorkFlowStateFolderVersionMapCount = Count(1) from fldr.WorkFlowStateFolderVersionMap where FolderID = @CurrentFolderID  select @WorkFlowStateUserMapCount= Count(1)  from fldr.WorkFlowStateUserMap where FolderID = @CurrentFolderID Select 'FolderVersionCount',1 as [Source],@FolderVersionCount as Destination UNION Select 'ForminstanceCount',1 As [Source],@ForminstanceCount as Destination UNION Select 'ForminstanceDatamapCount',1 as [Source],@ForminstanceDatamapCount as Destination UNION Select 'AccountFolderMapCount',0 as [Source],@AccountFolderMapCount as Destination UNION Select 'AccountProductMapCount',0 as [Source],@AccountProductMapCount as Destination UNION Select 'FolderVersionWorkFlowStateCount',0 as [Source],@FolderVersionWorkFlowStateCount as Destination UNION Select 'WorkFlowStateFolderVersionMapCount',0 as [Source],@WorkFlowStateFolderVersionMapCount as Destination UNION Select 'WorkFlowStateUserMapCount',0 as [Source],@WorkFlowStateUserMapCount as Destination Set @CurrentFolderID = NULL  Set @CurrentFolderVersionID = NULL  Set @CurrentFormInstanceID = NULL  Set @NewFormID = NULL  Set @NewFormDesignVersionID = NULL  Set @NewFormDesignGroupID = NULL  Set @FolderVersionCount = 0  Set @ForminstanceCount = 0  Set @ForminstanceDatamapCount = 0  Set @AccountFolderMapCount = 0  Set @AccountProductMapCount = 0  Set @FolderVersionWorkFlowStateCount = 0  Set @WorkFlowStateFolderVersionMapCount = 0  Set @WorkFlowStateUserMapCount = 0  Set @Formdata = NULL  Set @NewCategoryID = NULL  Set @NewConsortiumID = NULL  Commit TRANSACTION End Try  Begin Catch  Begin ROLLBACK TRANSACTION  End  SELECT  ERROR_NUMBER() AS ErrorNumber,ERROR_SEVERITY() AS ErrorSeverity,ERROR_LINE() AS ErrorLine,ERROR_MESSAGE() AS ErrorMessage;  End Catch